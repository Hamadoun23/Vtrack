<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic PWA - Vtrack</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .check-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #ccc;
        }
        .check-item.success {
            border-left-color: #28a745;
        }
        .check-item.error {
            border-left-color: #dc3545;
        }
        .check-item.warning {
            border-left-color: #ffc107;
        }
        h1 {
            color: #2538A1;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>üîç Diagnostic PWA - Vtrack</h1>
    
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');
        
        function addCheck(name, status, message) {
            const div = document.createElement('div');
            div.className = `check-item ${status}`;
            div.innerHTML = `<strong>${name}:</strong> ${message}`;
            results.appendChild(div);
        }

        // V√©rifier Service Worker
        if ('serviceWorker' in navigator) {
            addCheck('Service Worker Support', 'success', '‚úì Support√© par le navigateur');
            
            navigator.serviceWorker.getRegistrations().then(registrations => {
                if (registrations.length > 0) {
                    addCheck('Service Worker Enregistr√©', 'success', `‚úì ${registrations.length} service worker(s) actif(s)`);
                    registrations.forEach(reg => {
                        addCheck('Scope', 'success', `‚úì ${reg.scope}`);
                    });
                } else {
                    addCheck('Service Worker Enregistr√©', 'error', '‚úó Aucun service worker enregistr√©');
                }
            });
        } else {
            addCheck('Service Worker Support', 'error', '‚úó Non support√© par le navigateur');
        }

        // V√©rifier Manifest
        fetch('/manifest.json')
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Manifest non accessible');
            })
            .then(manifest => {
                addCheck('Manifest JSON', 'success', '‚úì Accessible et valide');
                addCheck('Nom App', 'success', `‚úì ${manifest.name}`);
                addCheck('Short Name', 'success', `‚úì ${manifest.short_name}`);
            })
            .catch(error => {
                addCheck('Manifest JSON', 'error', `‚úó ${error.message}`);
            });

        // V√©rifier les fichiers
        const filesToCheck = ['/sw.js', '/register-sw.js', '/logovalerie.jpeg'];
        filesToCheck.forEach(file => {
            fetch(file)
                .then(response => {
                    if (response.ok) {
                        addCheck(`Fichier ${file}`, 'success', '‚úì Accessible');
                    } else {
                        addCheck(`Fichier ${file}`, 'error', `‚úó Erreur ${response.status}`);
                    }
                })
                .catch(error => {
                    addCheck(`Fichier ${file}`, 'error', `‚úó ${error.message}`);
                });
        });

        // V√©rifier HTTPS/localhost
        if (location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
            addCheck('Contexte S√©curis√©', 'success', '‚úì HTTPS ou localhost (requis pour PWA)');
        } else {
            addCheck('Contexte S√©curis√©', 'warning', '‚ö† HTTP non s√©curis√© (PWA n√©cessite HTTPS en production)');
        }

        // V√©rifier l'ic√¥ne d'installation
        window.addEventListener('beforeinstallprompt', (e) => {
            addCheck('Installation PWA', 'success', '‚úì L\'application peut √™tre install√©e');
        });

        setTimeout(() => {
            if (!document.querySelector('.check-item:contains("Installation PWA")')) {
                addCheck('Installation PWA', 'warning', '‚ö† L\'ic√¥ne d\'installation n\'appara√Ætra que si tous les crit√®res sont remplis');
            }
        }, 2000);
    </script>
</body>
</html>

